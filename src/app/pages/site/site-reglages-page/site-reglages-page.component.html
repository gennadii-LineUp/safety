<header class="main-header">
  <div *ngIf="errorLoad" class="alert alert-danger alert-dismissible fade in" role="alert" style='position: fixed;' >
    <button type="button" class="close" data-dismiss="alert" aria-label="Close" (click)='cancellMessages()'>
      <span aria-hidden="true"></span>
    </button>
    <p>SAFETY: <span>{{errorLoad}}</span></p>
  </div>
  <div *ngIf="successUpdate" style='position: fixed;' class="alert alert-success">{{successUpdate}}</div>

  <h1>Réglages</h1>
  <img *ngIf="loading" style='position: absolute; left:49.3%; bottom:15%;' src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" />
</header>
<div *ngIf="siteReglages.name" class="main-content">
    <form #site_reglagesForm="ngForm" class="settings-form" novalidate (click)='cancellMessages()'
          enctype="multipart/form-data"
          (ngSubmit)="submitNewReglagesForm(site_reglagesForm)">
        <div class="settings-form-left-content-part">
            <h2>Site</h2>

            <div class="input-wrapper">
              <p [hidden]="name.invalid" class="requred-field color-valid">Nom*</p>
              <input type="text" class="form-control" placeholder="Nom*"
                     #name="ngModel" id="name" name='name' required [(ngModel)]="siteReglages.name" />
              <p [hidden]="name.valid || name.untouched " class="requred-field ">Champs requis</p>
            </div>
            <div class="input-wrapper">
              <p [hidden]="address.invalid" class="requred-field color-valid">Adresse*</p>
              <input type="text" class="form-control"  placeholder="Adresse*"
                    #address="ngModel" id="address" name='address' required [(ngModel)]="siteReglages.address" />
              <p [hidden]="address.valid || address.untouched " class="requred-field ">Champs requis</p>
            </div>
            <div class="input-wrapper">
              <p [hidden]="postalCode.invalid" class="requred-field color-valid">Code postal*</p>
              <input type="text" class="form-control"  placeholder="Code postal*"
                     #postalCode="ngModel" id="postalCode" name='postalCode' required [(ngModel)]="siteReglages.postalCode" />
              <p [hidden]="postalCode.valid || postalCode.untouched " class="requred-field ">Champs requis</p>
            </div>
            <div class="input-wrapper">
              <p [hidden]="city.invalid" class="requred-field color-valid">Ville*</p>
              <input type="text" class="form-control"  placeholder="Ville*"
                     #city="ngModel" id="city" name='city' required [(ngModel)]="siteReglages.city" />
              <p [hidden]="city.valid || city.untouched " class="requred-field ">Champs requis</p>
            </div>
        </div>
        <div class="settings-form-right-content-part">
            <h2>Personne qui autorise</h2>
            <div class="input-wrapper">
              <p [hidden]="signatoryName.invalid" class="requred-field color-valid">Nom du signataire*</p>
              <input type="text" class="form-control"  placeholder="Nom du signataire*"
                     #signatoryName="ngModel" id="signatoryName" name='signatoryName' required [(ngModel)]="siteReglages.signatoryName" />
              <p [hidden]="signatoryName.valid || signatoryName.untouched " class="requred-field ">Champs requis</p>
            </div>
            <div class="input-wrapper">
              <p [hidden]="signatorySurname.invalid" class="requred-field color-valid">Prénom du signataire*</p>
              <input type="text" class="form-control"  placeholder="Prénom du signataire*"
                     #signatorySurname="ngModel" id="signatorySurname" name='signatorySurname' required [(ngModel)]="siteReglages.signatorySurname" />
              <p [hidden]="signatorySurname.valid || signatorySurname.untouched " class="requred-field ">Champs requis</p>
            </div>
            <div class="signature-upload">
                <label for="file-input1">Ajouter signature
                    <span></span>
                </label>
                <input id="file-input1" type="file">
            </div>
            <div class="tampon-upload">
                <label for="file-input2">Ajouter tampon
                    <span></span>
                </label>
                <input id="file-input2" type="file">
            </div>
        </div>
        <div class="main-image-editor-wrapper">
            <h2>Image d’accueil</h2>
            <img  class="img-preview img-responsive" src="../../../../assets/img/site-img-min.jpg" alt="site-img-min">
            <div class="image-upload">
                <label for="file-input3">
                    <span></span>
                </label>
                <input id="file-input3" type="file">
            </div>
        </div>

        <div *ngIf='showAdminData || showEmployee_Admin || showClientData'>
          <div class="form-divider clearfix" style="margin-bottom: 20px;"></div>
          <h2 class="pull-left">Responsable(s) du site</h2>
          <img *ngIf="loadingResponsables" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" style='position: absolute; left: 10%;' />
          <button class="add-an-item-button" (click)="setEmptyData(); myModal.open()"></button>

          <!-- M O D A L -->

          <table class="table-default responsable-du-site-table">
            <thead>
            <tr>
              <th *ngFor="let header of headers" (click)="tableSortService.changeSorting(header.variable)">
                <button [class]="tableSortService.selectedClass(header.variable)" ></button>
                {{header.display}}
              </th>
              <th>
                <span>Action</span>
              </th>
            </tr>
            </thead>
            <tbody>
              <tr *ngIf='emptyTable_responsables'>
                <td>-</td>
                <td>-</td>
                <td>-</td>
              </tr>

              <!--employee_responsables-->
              <tr *ngFor="let employee_respo of employee_responsables" style="height: 40px;">
                <td>{{employee_respo.name | capitalizeFirstLetter}}</td>
                <td>{{employee_respo.responsible | responsableSite}}</td>
                <td>
                  <a href="javascript:void(0);" (click)='myModal.open(); getResponsableForUpdateFunction(employee_responsables)'>
                    Modifier
                  </a>
                  /
                  <a href="javascript:void(0);" (click)='deleteResponsableFunction(employee_respo.id)'>
                    Supprimer
                  </a>
                </td>
               </tr>
            </tbody>
          </table>
        </div>

        <div class="form-divider clearfix"></div>
        <h2  class="pull-left">Notifications par email</h2>
        <div class="input-wrapper pull-left">
            <p [hidden]="notificationEmails.invalid" class="requred-field color-valid">Email(s) de notification du site</p>
            <input class="form-control"  placeholder="Email(s) de notification du site*" type="email"
                   style="width: 100% !important;"
                   #notificationEmails="ngModel" id="notificationEmails" name='notificationEmails' required
                   [(ngModel)]="siteReglages.notificationEmails" /><!-- required email -->
            <p [hidden]="notificationEmails.valid || notificationEmails.untouched" class="requred-field ">Champs requis</p>
        </div>
      <div class="table-wrapper">
        <table class="table-default notifications-table">
          <thead>
              <tr>
                  <th style='cursor:default;'>
                      <span>Règle de notification</span>
                  </th>
                  <th style='cursor:default;'>
                      <span>Siège</span>
                  </th>
                  <th>
                      <span>Site</span>
                  </th>
              </tr>
          </thead>
          <tbody>
          <tr>
            <td>Caces</td>
            <td style="text-align: center !important;">
              <div class="control-group">
                <label class="control control--checkbox">
                  <input type="checkbox"
                         #cacesSiege="ngModel" id="cacesSiege"
                         name='cacesSiege' [(ngModel)]="siteReglages.cacesSiege" />
                  <span class="control__indicator"></span>
                </label>
              </div>
            </td>
            <td style="text-align: center !important;">
              <div class="control-group">
                <label class="control control--checkbox">
                  <input type="checkbox"
                         #cacesSite="ngModel" id="cacesSite"
                         name='cacesSite' [(ngModel)]="siteReglages.cacesSite" />
                  <span class="control__indicator"></span>
                </label>
              </div>
            </td>
          </tr>
          <tr>
            <td>Visite médicale</td>
            <td style="text-align: center !important;">
              <div class="control-group">
                <label class="control control--checkbox">
                  <input type="checkbox"
                         #medicalVisitSiege="ngModel" id="medicalVisitSiege"
                         name='medicalVisitSiege' [(ngModel)]="siteReglages.medicalVisitSiege" />
                  <span class="control__indicator"></span>
                </label>
              </div>
            </td>
            <td style="text-align: center !important;">
              <div class="control-group">
                <label class="control control--checkbox">
                  <input type="checkbox"
                         #medicalVisitSite="ngModel" id="medicalVisitSite"
                         name='medicalVisitSite' [(ngModel)]="siteReglages.medicalVisitSite" />
                  <span class="control__indicator"></span>
                </label>
              </div>
            </td>
          </tr>
          <tr>
            <td>Contrôle technique et VGP</td>
            <td style="text-align: center !important;">
              <div class="control-group">
                <label class="control control--checkbox">
                  <input type="checkbox"
                         #techControlSiege="ngModel" id="techControlSiege"
                         name='techControlSiege' [(ngModel)]="siteReglages.techControlSiege" />
                  <span class="control__indicator"></span>
                </label>
              </div>
            </td>
            <td style="text-align: center !important;">
              <div class="control-group">
                <label class="control control--checkbox">
                  <input type="checkbox"
                         #techControlSite="ngModel" id="techControlSite"
                         name='techControlSite' [(ngModel)]="siteReglages.techControlSite" />
                  <span class="control__indicator"></span>
                </label>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <div class="button-wrapper">
            <button type="button" class="form-button red-button annuler-button"
                  (click)="getReglagesFunction();">Annuler</button>
            <button type="submit" class="form-button green-button sauvegarder-button"
                    [disabled]="!site_reglagesForm.form.valid">Sauvegarder</button>

      </div>
    </form>
</div>



<site-reglages-modal #myModal tabindex="-1">
  <modal-header-SRM>
    <h2>Ouverture de droits</h2>
  </modal-header-SRM>

  <modal-content-SRM>

    <div class="input-wrapper" >
      <input class="form-control"  placeholder="Nom*" style="margin-bottom: 2px;"
             #findSalarieByName id="findSalarieByName" name='findSalarieByName' type="text"
             (keyup.enter)='findEmployeeByName_searchFunction(findSalarieByName.value, 1, "")'>
      <button (click)='findEmployeeByName_searchFunction(findSalarieByName.value, 1, "")'>
        <span></span>
      </button>
    </div>

    <div *ngIf="loaded" class="table-wrapper"  style="margin-top: -15px;">
      <table class="table-default salaries-site-table">
        <thead>
        </thead>
        <tbody>
        <tr *ngFor="let employee of employee_fromSearch" style="height: 40px;">
          <td style="width: 44%;">Nom: {{employee.name | capitalizeFirstLetter}}</td>
          <td style="width: 26%;">N° sécu: {{employee.numSecu | uppercase}}</td>
          <td style="width: 30%; text-align: left !important; padding-right: 0px;">Prénom: {{employee.surname | capitalizeFirstLetter}}
            <div class="input-wrapper" style="float: right;">
              <button style="margin-top: -9px; margin-right: 0px;"
                      (click)="takeEmployee_forSettingAccessFunction(employee);">
                <span></span>
              </button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <form #site_employeeAccessForm="ngForm"  novalidate  class="modal-form" (click)='cancellMessages()'
          (ngSubmit)="submitForm(site_employeeAccessForm)">
      <div class="table-wrapper" style="margin-top: 24px !important;">
        <table class="table-default ajouter-responsables-table">
          <thead>
          <tr>
            <th *ngFor="let mobileHeader of mobileHeaders" (click)="tableSortService.changeSorting(mobileHeader.variable)">
              <button [class]="tableSortService.selectedClass(mobileHeader.variable)" ></button>
              {{mobileHeader.display}}
            </th>
            <th>
              <span>Accès Général</span>
            </th>
            <th>
              <span>Accès Technique</span>
            </th>
          </tr>
          </thead>
          <tbody>
              <tr *ngIf='emptyTableMobile'>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
              </tr>

              <tr *ngFor="let employeeAccess of employee_forAccess" style="height: 40px;">
                  <td>{{employeeAccess.name | capitalizeFirstLetter}}</td>
                  <td>{{employeeAccess.numSecu | uppercase}}</td>
                  <td *ngFor="let type of types_employeeAccess" >
                      <div class="radio" >
                        <input type="radio"   id='{{employeeAccess.id}}{{type.id}}' name='{{employeeAccess.id}}'
                               [(ngModel)]="employeeAccess.responsible" [value]="type.id" >
                        <label for='{{employeeAccess.id}}{{type.id}}' class="radio-label" style="padding-right: 10px;"></label>
                      </div>
                  </td>
              </tr>
          </tbody>
        </table>
      </div>
      <div class="button-wrapper">
        <button type="submit" class="form-button red-button annuler-button" data-dismiss="modal"
                (click)="myModal.close();">Annuler</button>
        <button type="submit" class="form-button green-button creer-button" data-dismiss="modal"
                [disabled]="!employee_forAccess.length">Ajouter</button>
      </div>
    </form>
  </modal-content-SRM>

  <modal-footer-SRM>
  </modal-footer-SRM>
</site-reglages-modal>
